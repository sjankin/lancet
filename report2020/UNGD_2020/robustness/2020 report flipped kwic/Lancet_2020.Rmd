---
title: "Climate Change and Public Health"
author:
- affiliation: University of Birmingham
  email: n.dasandi@bham.ac.uk
  name: Niheer Dasandi
- affiliation: Hertie School
  email: jankin@hertie-school.org
  name: Slava Jankin Mikhaylov
date: 15 March 2020
output:
  html_notebook:
    toc: yes
  html_document: default
  pdf_document: 
    toc: yes
  word_document: 
    toc: yes
#biblio-style: apsr
#bibliography: eu.bib
#thanks: We thank Trump Administration for their generous support of climate change initiatives.
abstract: We look at the link between public health issues and climate change discussed in the UN General Debates.

---



#Data

Loading data from the UNGDC data


```{r message=FALSE}
#Loading packages and data
library(readtext)
library(quanteda)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(rworldmap)
library(RColorBrewer)
library(haven)
library(readxl)
```

```{r}

DATA_DIR <- "~/Dropbox/Research/UNGDC projects/UN Data/" 

ungd_files <- readtext(paste0(DATA_DIR, "TXT/*"), 
                                 docvarsfrom = "filenames", 
                                 dvsep="_", 
                                 docvarnames = c("Country", "Session", "Year"))


ungd_files$doc_id <- str_replace(ungd_files$doc_id , ".txt", "") %>%
   str_replace(. , "_\\d{2}", "")

```


##Creating corpus object(s)
```{r}
ungd_corpus <- corpus(ungd_files, text_field = "text") 

ungdc.2019 <- corpus_subset(ungd_corpus, Year==2019)

```



```{r}

corp_summary <- summarise(group_by(summary(ungd_corpus, n = 9349),Year),
                           total_speeches=n(),total_sentences=sum(Sentences),total_words=sum(Tokens))

readr::write_csv(corp_summary, "corp_summary.csv")

```




#Pre-processing

Tokenizing corpus.

```{r}
#Tokenization and basic pre-processing
tok <- tokens(ungd_corpus, what = "word",
              remove_punct = TRUE,
              remove_symbols = TRUE,
              remove_numbers = TRUE,
              remove_url = TRUE,
              split_hyphens = FALSE,
              verbose = TRUE)
```

Lowercasing and removing stopwords

```{r}
tok <- tokens_tolower(tok)
tok.r <- tokens_select(tok, stopwords("english"), selection = "remove", padding = FALSE)

```

#Setting up agreed dictionaries

Creating compound tokens from the key terms (phrases) in our dictionaries:
 
```{r}

mylist <- list( c("air", "pollution"), c("mental", "disorder"), c("mental", "disorders"), c("climate","change"), c("changing","climate"), c("climate","emergency"), c("climate","crisis"), c("climate","decay"), c("global","warming"), c("green","house"), c("extreme","weather"), c("global", "environmental", "change"), c("climate","variability"),  c("low","carbon"), c("renewable","energy"), c("carbon","emission"), c("carbon","emissions"), c("carbon","dioxide"), c("co2","emission"), c("co2","emissions"), c("climate","pollutant"), c("climate","pollutants"), c("carbon","neutral"), c("carbon","neutrality"), c("climate","neutrality"), c("net","zero")) 
 
```
 

```{r}
tok.compound <- tokens_compound(tok.r, mylist, valuetype = "fixed", concatenator = "_")
```


Creating the dictionary of climate change terms:

```{r}
climate_dict <- dictionary(list(climate =  c("climate_change", "changing_climate", "climate_emergency", "climate_crisis", "climate_decay", "global_warming", "green_house", "temperature", "extreme_weather", "global_environmental_change", "climate_variability", "greenhouse", "greenhouse-gas", "low_carbon", "ghge", "ghges", "renewable_energy", "carbon_emission", "carbon_emissions", "carbon_dioxide", "carbon-dioxide", "co2_emission", "co2_emissions", "climate_pollutant", "climate_pollutants", "decarbonization", "decarbonisation", "carbon_neutral", "carbon-neutral", "carbon_neutrality", "climate_neutrality", "net-zero", "net_zero"
)))

```

Creating the dictionary of health terms:

```{r}
health_dict <- dictionary(list(health = c("malaria", "diarrhoea", "infection", "disease", "diseases", "sars", "measles", "pneumonia", "epidemic", "epidemics", "pandemic", "pandemics", "epidemiology", "healthcare", "health", "mortality", "morbidity", "nutrition", "illness", "illnesses", "ncd", "ncds", "air_pollution", "nutrition", "malnutrition", "malnourishment", "mental_disorder", "mental_disorders", "stunting")))
```



## KWIC

Performing a keyword-in-context search. The window is set to 25 words before and after the term - reflecting approximately half a paragraph before and after the term (on average a paragraph in English is 50 words). UNGD speeches are highly structured documents drafted over long periods of time and reflect internal discussions and negotiations in government. Hence we assume that terms appearing within specific proximity of each other are related through the structured process of document generation.

We search for terms from our health dictionary and show the 25-word context around them. 

```{r}
tok.hea <- kwic(tok.compound, health_dict, window = 25, valuetype = "fixed")

readr::write_csv(tok.hea, "health_kwic_25_fixed.csv")

```

We search for terms from our climate change dictionary and show the 25-word context around them. 

```{r}
tok.cc <- kwic(tok.compound, climate_dict, window = 25, valuetype = "fixed")

readr::write_csv(tok.cc, "climate_kwic_25_fixed.csv")

```

To tap into the core proposition of this analysis - the link between climate change and health terms - we take the 25-word context around the health terms and search this context for climate change terms. 

Text surrounding health terms (25 words each side) is saved and transformed to a corpus object. We then perform key-word-in-context search of this health related corpus for the terms in our climate change dictionary. 

```{r}
corpus_climate <- corpus(tok.cc, split_context = FALSE, extract_keyword = TRUE)

tok.health.kwic <- kwic(corpus_climate, health_dict, window = 25, valuetype = "fixed")

readr::write_csv(tok.health.kwic, "intersection_kwic_25_fixed.csv")

```


### Robustness analysis

For robustness analysis we looked at different context window sizes and manually assessed them for the balance of false positives vs false negatives.

```{r}
tok.hea.5 <- kwic(tok.compound, health_dict, window = 5, valuetype = "fixed")
tok.cc.5 <- kwic(tok.compound, climate_dict, window = 5, valuetype = "fixed")
corpus_cc.5 <- corpus(tok.cc.5, split_context = FALSE, extract_keyword = TRUE)
tok.health.kwic.5 <- kwic(corpus_cc.5, health_dict, window = 5, valuetype = "fixed")
readr::write_csv(tok.health.kwic.5, "intersection_kwic_5_fixed.csv")
readr::write_csv(tok.hea.5, "health_kwic_5_fixed.csv")
readr::write_csv(tok.cc.5, "climate_kwic_5_fixed.csv")

tok.hea.10 <- kwic(tok.compound, health_dict, window = 10, valuetype = "fixed")
tok.cc.10 <- kwic(tok.compound, climate_dict, window = 10, valuetype = "fixed")
corpus_cc.10 <- corpus(tok.cc.10, split_context = FALSE, extract_keyword = TRUE)
tok.health.kwic.10 <- kwic(corpus_cc.10, health_dict, window = 10, valuetype = "fixed")
readr::write_csv(tok.health.kwic.10, "intersection_kwic_10_fixed.csv")
readr::write_csv(tok.hea.10, "health_kwic_10_fixed.csv")
readr::write_csv(tok.cc.10, "climate_kwic_10_fixed.csv")

tok.hea.30 <- kwic(tok.compound, health_dict, window = 30, valuetype = "fixed")
tok.cc.30 <- kwic(tok.compound, climate_dict, window = 30, valuetype = "fixed")
corpus_cc.30 <- corpus(tok.cc.30, split_context = FALSE, extract_keyword = TRUE)
tok.health.kwic.30 <- kwic(corpus_cc.30, health_dict, window = 30, valuetype = "fixed")
readr::write_csv(tok.health.kwic.30, "intersection_kwic_30_fixed.csv")
readr::write_csv(tok.hea.30, "health_kwic_30_fixed.csv")
readr::write_csv(tok.cc.30, "climate_kwic_30_fixed.csv")

tok.hea.50 <- kwic(tok.compound, health_dict, window = 50, valuetype = "fixed")
tok.cc.50 <- kwic(tok.compound, climate_dict, window = 50, valuetype = "fixed")
corpus_cc.50 <- corpus(tok.cc.50, split_context = FALSE, extract_keyword = TRUE)
tok.health.kwic.50 <- kwic(corpus_cc.50, health_dict, window = 50, valuetype = "fixed")
readr::write_csv(tok.health.kwic.50, "intersection_kwic_50_fixed.csv")
readr::write_csv(tok.hea.50, "health_kwic_50_fixed.csv")
readr::write_csv(tok.cc.50, "climate_kwic_50_fixed.csv")
```





```{r}
climate_dfm <- dfm(corpus_climate)

corpus_health <- corpus(tok.hea, split_context = FALSE, extract_keyword = TRUE)
health_dfm <- dfm(corpus_health)

corpus_intersection <- corpus(tok.health.kwic, split_context = FALSE, extract_keyword = TRUE)
intersection_dfm <- dfm(corpus_intersection)

health <- convert(health_dfm, "data.frame")
climate <- convert(climate_dfm, "data.frame")
intersection <- convert(intersection_dfm, "data.frame")

names(health)[1] <- "docid"
names(climate)[1] <- "docid"
names(intersection)[1] <- "docid"

health$"docid" <- str_extract(health$docid, "^([^.]+)")
climate$"docid" <- str_extract(climate$docid, "^([^.]+)")
intersection$"docid" <- str_extract(intersection$docid, "^([^.]+)")

health_counts <- health %>% group_by(docid) %>% summarise(health_count = n())
climate_counts <- climate %>% group_by(docid) %>% summarise(climate_count = n())
intersection_counts <- intersection %>% group_by(docid) %>% summarise(intersection_count = n())

total_counts <- climate_counts %>% 
  full_join(health_counts, by = "docid") %>% 
  full_join(intersection_counts, by = "docid") %>%
  replace_na(list(health_count=0, climate_count=0, intersection_count=0)) %>%
  separate(docid, c("country", "year"), "_")

total_counts$year <- as.numeric(total_counts$year)

total_counts <- arrange(total_counts, country, year)

```


```{r}
readr::write_csv(total_counts, "total_counts.csv")
```





# Maps of mention counts


## Map for 2019 of PH and CC

Keeping only country-years with at least one mention of CC in PH conext


```{r}

map <- joinCountryData2Map(subset(total_counts, year==2019 & health_count>0), joinCode="ISO3", nameJoinColumn="country")

new_world <- subset(map, continent != "Antarctica")

pdf("worldmap_2019_health.pdf", width = 7, height = 3)

par(mai=c(0,0,0.2,0),xaxs="i",yaxs="i")

mapParams <- mapCountryData(new_world, nameColumnToPlot="health_count", 
                            mapTitle="2019 UN General Debate: Health", 
                            catMethod = "categorical", 
                            colourPalette = "heat", 
                            oceanCol = "lightblue", 
                            missingCountryCol = "white", 
                            addLegend="FALSE")

do.call( addMapLegendBoxes, c(mapParams,title="Number of mentions",x = "bottom", horiz=TRUE, cex=0.5))

dev.off()
```


```{r}

map <- joinCountryData2Map(subset(total_counts, year==2019 & climate_count>0), joinCode="ISO3", nameJoinColumn="country")

new_world <- subset(map, continent != "Antarctica")

pdf("worldmap_2019_climate.pdf", width = 7, height = 3)

par(mai=c(0,0,0.2,0),xaxs="i",yaxs="i")

mapParams <- mapCountryData(new_world, nameColumnToPlot="climate_count", 
                            mapTitle="2019 UN General Debate: Climate Change", 
                            catMethod = "categorical", 
                            colourPalette = "heat", 
                            oceanCol = "lightblue", 
                            missingCountryCol = "white", 
                            addLegend="FALSE")

do.call( addMapLegendBoxes, c(mapParams,title="Number of mentions",x = "bottom", horiz=TRUE, cex=0.5))

dev.off()
```


```{r}

map <- joinCountryData2Map(subset(total_counts, year==2019 & intersection_count>0), joinCode="ISO3", nameJoinColumn="country")

new_world <- subset(map, continent != "Antarctica")

pdf("worldmap_2019_intersection.pdf", width = 7, height = 3)

par(mai=c(0,0,0.2,0),xaxs="i",yaxs="i")

mapParams <- mapCountryData(new_world, nameColumnToPlot="intersection_count", 
                            mapTitle="2019 UN General Debate: Intersection", 
                            catMethod = "categorical", 
                            colourPalette = "heat", 
                            oceanCol = "lightblue", 
                            missingCountryCol = "white", 
                            addLegend="FALSE")

do.call( addMapLegendBoxes, c(mapParams,title="Number of mentions",x = "bottom", horiz=TRUE, cex=0.5))

dev.off()
```


# Country plots

##USA

```{r}

total_counts <- total_counts %>% add_row(country = "USA", year = 2018, climate_count = 0, health_count = 0, intersection_count  =  0)
total_counts <- total_counts %>% add_row(country = "USA", year = 2019, climate_count = 0, health_count = 0, intersection_count  =  0)

ggplot(subset(total_counts, country=="USA"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("USA") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_USA.pdf")
```



##GBR

```{r}

total_counts <- total_counts %>% add_row(country = "GBR", year = 1970, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "GBR", year = 1971, climate_count = 0, health_count = 0, intersection_count  =  0)

ggplot(subset(total_counts, country=="GBR"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("UK") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_GBR.pdf")
```

##Germany
```{r}

total_counts <- total_counts %>% add_row(country = "DEU", year = 1970, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "DEU", year = 1971, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "DEU", year = 1972, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "DEU", year = 1973, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "DEU", year = 1974, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "DEU", year = 1975, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "DEU", year = 1976, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "DEU", year = 1977, climate_count = 0, health_count = 0, intersection_count  =  0)


ggplot(subset(total_counts, country=="DEU"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("Germany") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_DEU.pdf")
```



##France
```{r}
ggplot(subset(total_counts, country=="FRA"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("France") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_FRA.pdf")
```


##China
```{r}
total_counts <- total_counts %>% add_row(country = "CHN", year = 1971, climate_count = 0, health_count = 0, intersection_count  =  0) 

ggplot(subset(total_counts, country=="CHN"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("China") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_CHN.pdf")
```


##Norway
```{r}
total_counts <- total_counts %>% add_row(country = "NOR", year = 1970, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "NOR", year = 1971, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "NOR", year = 1972, climate_count = 0, health_count = 0, intersection_count  =  0)

ggplot(subset(total_counts, country=="NOR"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("Norway") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_NOR.pdf")
```


##Australia
```{r}
total_counts <- total_counts %>% add_row(country = "AUS", year = 1970, climate_count = 0, health_count = 0, intersection_count  =  0)

ggplot(subset(total_counts, country=="AUS"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("Australia") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_AUS.pdf")
```


##India
```{r}
total_counts <- total_counts %>% add_row(country = "IND", year = 1970, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "IND", year = 1971, climate_count = 0, health_count = 0, intersection_count  =  0)

ggplot(subset(total_counts, country=="IND"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("India") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_IND.pdf")
```


##Belgium
```{r}
total_counts <- total_counts %>% add_row(country = "BEL", year = 1970, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "BEL", year = 1971, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "BEL", year = 1972, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "BEL", year = 1973, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "BEL", year = 1974, climate_count = 0, health_count = 0, intersection_count  =  0) 

ggplot(subset(total_counts, country=="BEL"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("Belgium") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_BEL.pdf")
```


##Japan
```{r}

total_counts <- total_counts %>% add_row(country = "JPN", year = 1970, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "JPN", year = 1971, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "JPN", year = 1972, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "JPN", year = 1973, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "JPN", year = 1974, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "JPN", year = 1975, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "JPN", year = 1976, climate_count = 0, health_count = 0, intersection_count  =  0) %>% add_row(country = "JPN", year = 1977, climate_count = 0, health_count = 0, intersection_count  =  0) 

ggplot(subset(total_counts, country=="JPN"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("Japan") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_JPN.pdf")
```

#EU

```{r}
#eu presidencies

total_counts$country_alt <- total_counts$country

total_counts$country_alt[total_counts$country== "BEL" & total_counts$year == 1970] <- "EU"
total_counts$country_alt[total_counts$country== "ITA" & total_counts$year == 1971] <- "EU"
total_counts$country_alt[total_counts$country== "NLD" & total_counts$year == 1972] <- "EU"
total_counts$country_alt[total_counts$country== "DNK" & total_counts$year == 1973] <- "EU"
total_counts$country_alt[total_counts$country== "FRA" & total_counts$year == 1974] <- "EU"
total_counts$country_alt[total_counts$country== "ITA" & total_counts$year == 1975] <- "EU"
total_counts$country_alt[total_counts$country== "NLD" & total_counts$year == 1976] <- "EU"
total_counts$country_alt[total_counts$country== "BEL" & total_counts$year == 1977] <- "EU"
total_counts$country_alt[total_counts$country== "DEU" & total_counts$year == 1978] <- "EU"
total_counts$country_alt[total_counts$country== "IRL" & total_counts$year == 1979] <- "EU"
total_counts$country_alt[total_counts$country== "LUX" & total_counts$year == 1980] <- "EU"
total_counts$country_alt[total_counts$country== "GBR" & total_counts$year == 1981] <- "EU"
total_counts$country_alt[total_counts$country== "DNK" & total_counts$year == 1982] <- "EU"
total_counts$country_alt[total_counts$country== "GRC" & total_counts$year == 1983] <- "EU"
total_counts$country_alt[total_counts$country== "IRL" & total_counts$year == 1984] <- "EU"
total_counts$country_alt[total_counts$country== "LUX" & total_counts$year == 1985] <- "EU"
total_counts$country_alt[total_counts$country== "GBR" & total_counts$year == 1986] <- "EU"
total_counts$country_alt[total_counts$country== "DNK" & total_counts$year == 1987] <- "EU"
total_counts$country_alt[total_counts$country== "GRC" & total_counts$year == 1988] <- "EU"
total_counts$country_alt[total_counts$country== "FRA" & total_counts$year == 1989] <- "EU"
total_counts$country_alt[total_counts$country== "ITA" & total_counts$year == 1990] <- "EU"
total_counts$country_alt[total_counts$country== "NLD" & total_counts$year == 1991] <- "EU"
total_counts$country_alt[total_counts$country== "GBR" & total_counts$year == 1992] <- "EU"
total_counts$country_alt[total_counts$country== "BEL" & total_counts$year == 1993] <- "EU"
total_counts$country_alt[total_counts$country== "DEU" & total_counts$year == 1994] <- "EU"
total_counts$country_alt[total_counts$country== "ESP" & total_counts$year == 1995] <- "EU"
total_counts$country_alt[total_counts$country== "IRL" & total_counts$year == 1996] <- "EU"
total_counts$country_alt[total_counts$country== "LUX" & total_counts$year == 1997] <- "EU"
total_counts$country_alt[total_counts$country== "AUT" & total_counts$year == 1998] <- "EU"
total_counts$country_alt[total_counts$country== "FIN" & total_counts$year == 1999] <- "EU"
total_counts$country_alt[total_counts$country== "FRA" & total_counts$year == 2000] <- "EU"
total_counts$country_alt[total_counts$country== "BEL" & total_counts$year == 2001] <- "EU"
total_counts$country_alt[total_counts$country== "DNK" & total_counts$year == 2002] <- "EU"
total_counts$country_alt[total_counts$country== "ITA" & total_counts$year == 2003] <- "EU"
total_counts$country_alt[total_counts$country== "NLD" & total_counts$year == 2004] <- "EU"
total_counts$country_alt[total_counts$country== "GBR" & total_counts$year == 2005] <- "EU"
total_counts$country_alt[total_counts$country== "FIN" & total_counts$year == 2006] <- "EU"
total_counts$country_alt[total_counts$country== "PRT" & total_counts$year == 2007] <- "EU"
total_counts$country_alt[total_counts$country== "FRA" & total_counts$year == 2008] <- "EU"
total_counts$country_alt[total_counts$country== "SWE" & total_counts$year == 2009] <- "EU"
total_counts$country_alt[total_counts$country== "BEL" & total_counts$year == 2010] <- "EU"


```



```{r}

total_counts <- total_counts %>% add_row(country_alt = "EU", year = 1970, climate_count = 0, health_count = 0, intersection_count  =  0) %>%  add_row(country_alt = "EU", year = 1971, climate_count = 0, health_count = 0, intersection_count  =  0)

ggplot(subset(total_counts, country_alt=="EU"), aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= health_count), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= climate_count), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= intersection_count), colour = "red", alpha = 0.9) +
  ggtitle("EU") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

ggsave("timeseries_all_total_count_EU.pdf")
```



# Time series of total counts plot

## total counts


```{r}
# calculating the total number of mentions by year
sum <- summarise(group_by(total_counts, year), 
                 sum_CC = sum(climate_count), sum_PH = sum(health_count), sum_int = sum(intersection_count),
                 mean_CC = mean(climate_count), mean_PH = mean(health_count), mean_int = mean(intersection_count))

```



```{r}
ggplot(sum, aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= sum_PH), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= sum_CC), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
#  geom_line(aes(y= count), colour = "black", alpha = 0.9) +
  #ggtitle("Political engagement with the intersection of climate change and health") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))+
 annotate("text", x = 2000, y = 850, label = "Climate Change", colour = "darkgreen")+
  annotate("text", x = 1993, y = 250, label = "Health", colour = "blue")

ggsave("timeseries_PHCC_total_count.pdf")
```



```{r}
ggplot(sum, aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= sum_int), colour = "red", alpha = 0.9) +
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019)) +
   annotate("text", x = 2015, y = 20, label = "Intersection", colour = "red")

ggsave("timeseries_intersection_total_count.pdf")
```



```{r}
readr::write_csv(sum, "figure57.csv")
```




```{r}
ggplot(sum, aes(x=year)) +
  theme_bw() +
  geom_line(aes(y= sum_PH), colour = "blue", alpha = 0.9, linetype="dotdash") +
  geom_line(aes(y= sum_CC), colour = "darkgreen", alpha = 0.9, linetype="dashed") +
  geom_line(aes(y= sum_int), colour = "red", alpha = 0.9) +
  #ggtitle("Political engagement with the intersection of climate change and health") + 
  ylab("Total number of references per UNGD session") + xlab("Year") + 
#  scale_y_continuous(limits=c(0, 140), breaks = c(1, 50, 100, 134)) +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))+
 annotate("text", x = 2000, y = 850, label = "Climate Change", colour = "darkgreen")+
  annotate("text", x = 1993, y = 250, label = "Health", colour = "blue") +
  annotate("text", x = 2015, y = 100, label = "Intersection", colour = "red")

ggsave("timeseries_all_total_count.pdf")
```











## Proportion of countries presentation

Proportion of countries that had at least one mention

Data preparation

```{r}

climate_speeches <- total_counts %>% filter(climate_count>0) %>% group_by(year) %>% tally(name = "climate_speeches")
health_speeches <- total_counts %>% filter(health_count>0) %>% group_by(year) %>% tally(name = "health_speeches")
intersection_speeches <- total_counts %>% filter(intersection_count>0) %>% group_by(year) %>% tally(name = "intersection_speeches")
total_speeches <- ungd_files %>% group_by(Year) %>% tally(name = "total_speeches")

proportions <- left_join(total_speeches, health_speeches, by = c("Year"="year")) %>% 
  left_join(., climate_speeches, by = c("Year"="year")) %>% 
  left_join(., intersection_speeches, by = c("Year"="year")) %>% 
  replace_na(list(health_speeches=0, climate_speeches=0, intersection_speeches=0))

proportions$percent_int <- proportions$intersection_speeches/proportions$total_speeches*100
proportions$percent_CC <- proportions$climate_speeches/proportions$total_speeches*100
proportions$percent_PH <- proportions$health_speeches/proportions$total_speeches*100

readr::write_csv(proportions, "proportion_results.csv")
```


Plotting the country proportion


```{r}
ggplot(proportions, aes(x=Year, y=percent_CC, group = 1)) +
  geom_line(colour="darkgreen", size=1) +
  theme_bw() +
  #ggtitle("Political engagement with the intersection of climate change and health") + 
  ylab("Proportion of countries discussing climate change, %") + xlab("Year") + 
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

 ggsave("total_percent_CC.pdf")
```


```{r}
ggplot(proportions, aes(x=Year, y=percent_PH, group = 1)) +
  geom_line(colour="blue", size=1) +
  theme_bw() +
  #ggtitle("Political engagement with the intersection of climate change and health") + 
  ylab("Proportion of countries discussing health, %") + xlab("Year") + 
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000,2010, 2019))

  ggsave("total_percent_PH.pdf")
```


```{r}
ggplot(proportions, aes(x=Year, y=percent_int, group = 1)) +
  geom_line(colour="red", size=1) +
  theme_bw() +
  #ggtitle("Political engagement with the intersection of climate change and health") + 
  ylab("Proportion of countries discussing intersection, %") + xlab("Year") + 
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("total_percent_intersection.pdf")
```


```{r}
ggplot(proportions, aes(x=Year)) +
  geom_line(aes(y=percent_int), colour="red", size=1) +
  geom_line(aes(y=percent_CC), colour="darkgreen", linetype = "dashed", size=1) +
  geom_line(aes(y=percent_PH), colour="blue", linetype = "dotdash", size=1) +
  theme_bw() +
  #ggtitle("Political engagement with the intersection of climate change and health") + 
  ylab("Proportion of countries, %") + xlab("Year") + 
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))+
 annotate("text", x = 2014, y = 30, label = "Intersection", colour = "red")+
  annotate("text", x = 1975, y = 55, label = "Health", colour = "blue") +
  annotate("text", x = 1988, y = 27, label = "Climate Change", colour = "darkgreen")

  ggsave("all_three_percent.pdf")
```





#Tier Analysis


```{r}
sids_countries <- c("ASM","AIA","ATG","ABW","BHS","BHR","BRB","BLZ","BMU","CPV","COM","COK","CUB","DMA","DOM","FJI","GRD","GUM","GNB","GUY","HTI","JAM","KIR","MDV","MHL","MUS","FSM","MSR","NRU","NCL","NIU","PLW","PNG","PRI","KNA","LCA","VCT","WSM","STP","SYC","SGP","SLB","SUR","TLS","TON","TTO","TUV","VUT")
tier1_countries <- c("USA","EU", "CHN")
tier2_countries <- c("POL","AUS", "ZAF", "BRA", "IND", "FRA", "DEU", "IDN", "GBR")

total_counts$country_groups <- ifelse(total_counts$country %in% sids_countries, "SIDS", "none")
total_counts$country_groups[total_counts$country %in% tier1_countries] <- "Tier1"
total_counts$country_groups[total_counts$country %in% tier2_countries] <- "Tier2"

#eu presidencies
total_counts$country_groups[total_counts$country== "BEL" & total_counts$year == 1970] <- "Tier1"
total_counts$country_groups[total_counts$country== "ITA" & total_counts$year == 1971] <- "Tier1"
total_counts$country_groups[total_counts$country== "NLD" & total_counts$year == 1972] <- "Tier1"
total_counts$country_groups[total_counts$country== "DNK" & total_counts$year == 1973] <- "Tier1"
total_counts$country_groups[total_counts$country== "FRA" & total_counts$year == 1974] <- "Tier1"
total_counts$country_groups[total_counts$country== "ITA" & total_counts$year == 1975] <- "Tier1"
total_counts$country_groups[total_counts$country== "NLD" & total_counts$year == 1976] <- "Tier1"
total_counts$country_groups[total_counts$country== "BEL" & total_counts$year == 1977] <- "Tier1"
total_counts$country_groups[total_counts$country== "DEU" & total_counts$year == 1978] <- "Tier1"
total_counts$country_groups[total_counts$country== "IRL" & total_counts$year == 1979] <- "Tier1"
total_counts$country_groups[total_counts$country== "LUX" & total_counts$year == 1980] <- "Tier1"
total_counts$country_groups[total_counts$country== "GBR" & total_counts$year == 1981] <- "Tier1"
total_counts$country_groups[total_counts$country== "DNK" & total_counts$year == 1982] <- "Tier1"
total_counts$country_groups[total_counts$country== "GRC" & total_counts$year == 1983] <- "Tier1"
total_counts$country_groups[total_counts$country== "IRL" & total_counts$year == 1984] <- "Tier1"
total_counts$country_groups[total_counts$country== "LUX" & total_counts$year == 1985] <- "Tier1"
total_counts$country_groups[total_counts$country== "GBR" & total_counts$year == 1986] <- "Tier1"
total_counts$country_groups[total_counts$country== "DNK" & total_counts$year == 1987] <- "Tier1"
total_counts$country_groups[total_counts$country== "GRC" & total_counts$year == 1988] <- "Tier1"
total_counts$country_groups[total_counts$country== "FRA" & total_counts$year == 1989] <- "Tier1"
total_counts$country_groups[total_counts$country== "ITA" & total_counts$year == 1990] <- "Tier1"
total_counts$country_groups[total_counts$country== "NLD" & total_counts$year == 1991] <- "Tier1"
total_counts$country_groups[total_counts$country== "GBR" & total_counts$year == 1992] <- "Tier1"
total_counts$country_groups[total_counts$country== "BEL" & total_counts$year == 1993] <- "Tier1"
total_counts$country_groups[total_counts$country== "DEU" & total_counts$year == 1994] <- "Tier1"
total_counts$country_groups[total_counts$country== "ESP" & total_counts$year == 1995] <- "Tier1"
total_counts$country_groups[total_counts$country== "IRL" & total_counts$year == 1996] <- "Tier1"
total_counts$country_groups[total_counts$country== "LUX" & total_counts$year == 1997] <- "Tier1"
total_counts$country_groups[total_counts$country== "AUT" & total_counts$year == 1998] <- "Tier1"
total_counts$country_groups[total_counts$country== "FIN" & total_counts$year == 1999] <- "Tier1"
total_counts$country_groups[total_counts$country== "FRA" & total_counts$year == 2000] <- "Tier1"
total_counts$country_groups[total_counts$country== "BEL" & total_counts$year == 2001] <- "Tier1"
total_counts$country_groups[total_counts$country== "DNK" & total_counts$year == 2002] <- "Tier1"
total_counts$country_groups[total_counts$country== "ITA" & total_counts$year == 2003] <- "Tier1"
total_counts$country_groups[total_counts$country== "NLD" & total_counts$year == 2004] <- "Tier1"
total_counts$country_groups[total_counts$country== "GBR" & total_counts$year == 2005] <- "Tier1"
total_counts$country_groups[total_counts$country== "FIN" & total_counts$year == 2006] <- "Tier1"
total_counts$country_groups[total_counts$country== "PRT" & total_counts$year == 2007] <- "Tier1"
total_counts$country_groups[total_counts$country== "FRA" & total_counts$year == 2008] <- "Tier1"
total_counts$country_groups[total_counts$country== "SWE" & total_counts$year == 2009] <- "Tier1"
total_counts$country_groups[total_counts$country== "BEL" & total_counts$year == 2010] <- "Tier1"


ungd_files$country_groups <- ifelse(ungd_files$Country %in% sids_countries, "SIDS", "none")
ungd_files$country_groups[ungd_files$Country %in% tier1_countries] <- "Tier1"
ungd_files$country_groups[ungd_files$Country %in% tier2_countries] <- "Tier2"


ungd_files$country_groups[ungd_files$Country== "BEL" & ungd_files$Year == 1970] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "ITA" & ungd_files$Year == 1971] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "NLD" & ungd_files$Year == 1972] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "DNK" & ungd_files$Year == 1973] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "FRA" & ungd_files$Year == 1974] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "ITA" & ungd_files$Year == 1975] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "NLD" & ungd_files$Year == 1976] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "BEL" & ungd_files$Year == 1977] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "DEU" & ungd_files$Year == 1978] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "IRL" & ungd_files$Year == 1979] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "LUX" & ungd_files$Year == 1980] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "GBR" & ungd_files$Year == 1981] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "DNK" & ungd_files$Year == 1982] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "GRC" & ungd_files$Year == 1983] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "IRL" & ungd_files$Year == 1984] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "LUX" & ungd_files$Year == 1985] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "GBR" & ungd_files$Year == 1986] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "DNK" & ungd_files$Year == 1987] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "GRC" & ungd_files$Year == 1988] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "FRA" & ungd_files$Year == 1989] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "ITA" & ungd_files$Year == 1990] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "NLD" & ungd_files$Year == 1991] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "GBR" & ungd_files$Year == 1992] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "BEL" & ungd_files$Year == 1993] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "DEU" & ungd_files$Year == 1994] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "ESP" & ungd_files$Year == 1995] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "IRL" & ungd_files$Year == 1996] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "LUX" & ungd_files$Year == 1997] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "AUT" & ungd_files$Year == 1998] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "FIN" & ungd_files$Year == 1999] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "FRA" & ungd_files$Year == 2000] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "BEL" & ungd_files$Year == 2001] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "DNK" & ungd_files$Year == 2002] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "ITA" & ungd_files$Year == 2003] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "NLD" & ungd_files$Year == 2004] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "GBR" & ungd_files$Year == 2005] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "FIN" & ungd_files$Year == 2006] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "PRT" & ungd_files$Year == 2007] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "FRA" & ungd_files$Year == 2008] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "SWE" & ungd_files$Year == 2009] <- "Tier1"
ungd_files$country_groups[ungd_files$Country== "BEL" & ungd_files$Year == 2010] <- "Tier1"


```


```{r}

climate_speeches_groups <- total_counts %>% filter(climate_count>0) %>% group_by(year, country_groups) %>% tally(name = "climate_speeches")

health_speeches_groups <- total_counts %>% filter(health_count>0) %>% group_by(year, country_groups) %>% tally(name = "health_speeches")

intersection_speeches_groups <- total_counts %>% filter(intersection_count>0) %>% group_by(year, country_groups) %>% tally(name = "intersection_speeches")


total_speeches_groups <- ungd_files %>% 
  group_by(Year, country_groups) %>% tally(name = "total_speeches")

proportions_groups <- left_join(total_speeches_groups, health_speeches_groups, by = c("Year"="year", "country_groups")) %>% 
  left_join(., climate_speeches_groups, by = c("Year"="year", "country_groups")) %>% 
  left_join(., intersection_speeches_groups, by = c("Year"="year", "country_groups")) %>% 
  replace_na(list(health_speeches=0, climate_speeches=0, intersection_speeches=0))

proportions_groups$percent_int <- proportions_groups$intersection_speeches/proportions_groups$total_speeches*100

proportions_groups$percent_CC <- proportions_groups$climate_speeches/proportions_groups$total_speeches*100

proportions_groups$percent_PH <- proportions_groups$health_speeches/proportions_groups$total_speeches*100

proportions_groups <- proportions_groups %>% filter(country_groups!="none")

```


##Total count plots by country group

```{r}
ggplot(proportions_groups, aes(x=Year, y=health_speeches, group=country_groups, linetype = country_groups, colour = country_groups)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Health") + 
  ylab("Total number of references per UNGD session") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("PH_total_by_country_group.pdf")
```


```{r}
ggplot(proportions_groups, aes(x=Year, y=climate_speeches, group=country_groups, linetype = country_groups, colour = country_groups)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Climate Change") + 
  ylab("Total number of references per UNGD session") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("CC_total_by_country_group.pdf")
```


```{r}
ggplot(proportions_groups, aes(x=Year, y=intersection_speeches, group=country_groups, linetype = country_groups, colour = country_groups)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Intersection") + 
  ylab("Total number of references per UNGD session") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("intersection_total_by_country_group.pdf")
```



##Proportion plots by country group


```{r}
ggplot(proportions_groups, aes(x=Year, y=percent_PH, group=country_groups, linetype = country_groups, colour = country_groups)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Discussion of Health") + 
  ylab("Proportion of Countries, %") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000,  2010, 2019))

  ggsave("PH_percent_country_group.pdf")
```




```{r}
ggplot(proportions_groups, aes(x=Year, y=percent_CC, group=country_groups, linetype = country_groups, colour = country_groups)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Discussion of Climate Change") + 
  ylab("Proportion of Countries, %") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("CC_percent_country_group.pdf")
```


```{r}
ggplot(proportions_groups, aes(x=Year, y=percent_int, group=country_groups, linetype = country_groups, colour = country_groups)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Discussion of intersection") + 
  ylab("Proportion of Countries, %") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("intersection_percent_country_group.pdf")
```





#WHO regions

## Total counts by WHO region

Using UN M49 Standard (Standard country or area codes for statistical use (M49)) we create regional and sub-regional groupings of countries. [https://unstats.un.org/unsd/methodology/m49/]


```{r}
#loading WHO regions country identifiers and preprocessing
regions <- readr::read_csv("../UNSD - Methodology.csv")

#UNGDC used YUG designation while WHO is using SRB
total_counts$country <- str_replace(total_counts$country, "YUG", "SRB")

#merging WHO designations with mention counts
regional_data <- inner_join(total_counts, regions, by = c("country" = "ISO-alpha3 Code"))

# total sum of mention counts by year and WHO region, with means
who_sum <- summarise(group_by(regional_data, year, WHO), 
                     who_int = sum(intersection_count), who_PH = sum(health_count), who_CC = sum(climate_count))

```

```{r}
readr::write_csv(regional_data, "who_regions_data.csv")
readr::write_csv(who_sum, "figure58.csv")

```



Plot by region


```{r}
ggplot(who_sum, aes(x=year, y=who_PH, group=WHO, linetype = WHO, colour = WHO)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Health") + 
  ylab("Total number of references per UNGD session") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("PH_total_by_who.pdf")
```





```{r}
ggplot(who_sum, aes(x=year, y=who_CC, group=WHO, linetype = WHO, colour = WHO)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Climate Change") + 
  ylab("Total number of references per UNGD session") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("CC_total_by_who.pdf")
```




```{r}
ggplot(who_sum, aes(x=year, y=who_int, group=WHO, linetype = WHO, colour = WHO)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Intersection") + 
  ylab("Total number of references per UNGD session") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("intersection_total_by_who.pdf")
```





## Proportion by WHO region

Data preparation

```{r}

climate_speeches_who <- regional_data %>% filter(climate_count>0) %>% group_by(year, WHO) %>% tally(name = "climate_speeches")
health_speeches_who <- regional_data %>% filter(health_count>0) %>% group_by(year, WHO) %>% tally(name = "health_speeches")
intersection_speeches_who <- regional_data %>% filter(intersection_count>0) %>% group_by(year, WHO) %>% tally(name = "intersection_speeches")

#merging WHO designations with mention counts
ungd_files$Country <- str_replace(ungd_files$Country, "YUG", "SRB")

total_speeches_who <- inner_join(ungd_files, regions, by = c("Country" = "ISO-alpha3 Code")) %>% 
  group_by(Year, WHO) %>% tally(name = "total_speeches")

proportions_who <- left_join(total_speeches_who, health_speeches_who, by = c("Year"="year", "WHO")) %>% 
  left_join(., climate_speeches_who, by = c("Year"="year", "WHO")) %>% 
  left_join(., intersection_speeches_who, by = c("Year"="year", "WHO")) %>% 
  replace_na(list(health_speeches=0, climate_speeches=0, intersection_speeches=0))

proportions_who$percent_int <- proportions_who$intersection_speeches/proportions_who$total_speeches*100
proportions_who$percent_CC <- proportions_who$climate_speeches/proportions_who$total_speeches*100
proportions_who$percent_PH <- proportions_who$health_speeches/proportions_who$total_speeches*100

```


```{r}
readr::write_csv(proportions_who, "figure56.csv")
```


Plotting


```{r}
ggplot(proportions_who, aes(x=Year, y=percent_PH, group=WHO, linetype = WHO, colour = WHO)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Discussion of Health") + 
  ylab("Proportion of Countries, %") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("PH_percent_who.pdf")
```


```{r}
ggplot(proportions_who, aes(x=Year, y=percent_CC, group=WHO, linetype = WHO, colour = WHO)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
 ggtitle("Discussion of Climate Change") + 
  ylab("Proportion of Countries, %") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("CC_percent_who.pdf")
```





```{r}
ggplot(proportions_who, aes(x=Year, y=percent_int, group=WHO, linetype = WHO, colour = WHO)) +
    geom_line() +
  guides(colour=guide_legend(title=NULL), linetype = FALSE) +
 guides(linetype=guide_legend(title=NULL)) +
  theme_bw() +
  ggtitle("Discussion of Intersection") + 
  ylab("Proportion of countries, %") + xlab("Year") +
  theme(legend.position="bottom") +
  scale_x_continuous(limits=c(1970, 2019), breaks = c(1970, 1980, 1990, 2000, 2010, 2019))

  ggsave("intersection_percent_who.pdf")
```




